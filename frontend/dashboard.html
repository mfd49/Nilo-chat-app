<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Chat - Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0fff0; display: flex; min-height: 100vh; margin: 0; color: #333; }
        .sidebar { width: 200px; background-color: #008000; color: white; padding: 20px; box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); }
        .sidebar h2 { margin-top: 0; border-bottom: 1px solid #3cb371; padding-bottom: 10px; }
        .sidebar ul { list-style: none; padding: 0; margin: 20px 0; }
        .sidebar ul li { padding: 8px 0; border-bottom: 1px dashed #3cb371; }
        .sidebar button { width: 100%; padding: 10px; background-color: #ff4500; color: white; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; margin-top: 20px; }
        .sidebar button:hover { background-color: #ff6347; }
        .main-content { flex-grow: 1; display: flex; flex-direction: column; padding: 20px; }
        #welcome-message { font-size: 1.5em; color: #008000; margin-bottom: 20px; }
        .chat-window { flex-grow: 1; border: 1px solid #ccc; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; background: #fff; }
        #messages { list-style: none; padding: 10px; margin: 0; overflow-y: auto; flex-grow: 1; }
        #messages li { padding: 8px 10px; border-bottom: 1px dotted #eee; }
        .input-area { display: flex; padding: 10px; border-top: 1px solid #ccc; }
        #message-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px 0 0 6px; }
        #send-button { padding: 10px 15px; background-color: #008000; color: white; border: none; border-radius: 0 6px 6px 0; cursor: pointer; transition: background-color 0.3s; }
        #send-button:hover { background-color: #3cb371; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2 id="welcome-message"></h2>
        <h2>Aktif Kullanıcılar</h2>
        <ul id="user-list">
            </ul>
        <button id="logout-button">Çıkış Yap</button>
    </div>
    <div class="main-content">
        <div class="chat-window">
            <ul id="messages">
                </ul>
            <div class="input-area">
                <input type="text" id="message-input" placeholder="Mesajınızı yazın...">
                <button id="send-button">Gönder</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
    <script>
        // Kullanıcı bilgisi localStorage'dan alınıyor...
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
            window.location.href = 'login.html'; // Giriş yapılmadıysa yönlendir
        }

        // *** DÜZELTİLMİŞ URL ***
        const socket = io('https://nilo-chat-app.onrender.com');

        document.getElementById('welcome-message').textContent = `Hoşgeldiniz, ${user.username}!`;

        // Diğer Socket.IO kodları buraya devam ediyor...
        socket.emit('login', { username: user.username });
        
        // Mesaj gönderme, alma ve listeleme fonksiyonları...
        document.getElementById('send-button').addEventListener('click', () => {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value.trim();
            if (message) {
                socket.emit('chat message', { username: user.username, message: message });
                messageInput.value = '';
            }
        });

        socket.on('chat message', (msg) => {
            const messages = document.getElementById('messages');
            const item = document.createElement('li');
            item.textContent = `${msg.username}: ${msg.message}`;
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight;
        });

        // Kullanıcı listesi güncellemeleri
        socket.on('update users', (users) => {
            const userList = document.getElementById('user-list');
            userList.innerHTML = ''; // Listeyi temizle
            users.forEach(username => {
                const item = document.createElement('li');
                item.textContent = username;
                userList.appendChild(item);
            });
        });

        // Çıkış (Logout) fonksiyonu
        document.getElementById('logout-button').addEventListener('click', () => {
            localStorage.removeItem('user');
            socket.disconnect();
            window.location.href = 'login.html';
        });
    </script>
</body>
</html>